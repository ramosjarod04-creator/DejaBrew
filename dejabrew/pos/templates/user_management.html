{% extends 'base.html' %}
{% load static %}

{% block title %}User Management - Deja Brew{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'pos/css/users.css' %}">
{% endblock %}

{% block content %}
<div class="header">
    <h1>User Management</h1>
    <p>Create and manage user accounts</p>
</div>

<!-- Flash Messages -->
{% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<!-- Create User Form -->
<div class="card">
    <h2>Create New User</h2>
    <form method="POST" action="{% url 'create_user' %}">
        {% csrf_token %}
        
        <div class="form-grid">
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" name="username" id="username" required placeholder="Enter username">
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" name="email" id="email" placeholder="user@dejabrew.com">
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" required placeholder="Enter password">
            </div>

            <div class="form-group">
                <label for="role">Role</label>
                <select name="role" id="role" required>
                    <option value="">Select Role</option>
                    <option value="admin">Admin</option>
                    <option value="staff">Staff</option>
                </select>
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Create User Account</button>
    </form>
</div>

<!-- User Table -->
<div class="card">
    <h2>All Users</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Date Joined</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.id }}</td>
                <td><strong>{{ user.username }}</strong></td>
                <td>{{ user.email|default:"N/A" }}</td>
                <td>
                    {% if user.is_superuser or user.profile.role == 'admin' %}
                        <span class="badge badge-admin">Admin</span>
                    {% else %}
                        <span class="badge badge-staff">Staff</span>
                    {% endif %}
                </td>
                <td>{{ user.date_joined|date:"M d, Y" }}</td>
                <td>
                    {% if user.id != request.user.id %}
                        <form method="POST" action="{% url 'delete_user' user.id %}" onsubmit="return confirm('Are you sure you want to delete user {{ user.username }}?');">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    {% else %}
                        <span class="muted-text">Current User</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No users found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}